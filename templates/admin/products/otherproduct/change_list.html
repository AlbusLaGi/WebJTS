{% extends "admin/change_list.html" %}

{% block object-tools-items %}
    {{ block.super }}
    {% if show_google_sheet_import %}
        <li>
            <a href="#google-sheet-import" id="import-sheets-link" class="addlink">Importar desde Google Sheets</a>
        </li>
    {% endif %}
{% endblock %}

{% block content %}
    {{ block.super }}

    <!-- Formulario oculto para importación desde Google Sheets -->
    {% if show_google_sheet_import %}
        <div id="google-sheet-import" class="dialog" style="display:none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1050; background: white; padding: 20px; border: 1px solid #ccc; box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-radius: 4px;">
            <div class="module">
                <h2>Importar Otros Productos desde Google Sheets</h2>
                <form method="post" action="{% url 'products:import_other_products_from_sheet' %}" id="import-form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="sheet_url">URL del Google Sheet:</label>
                        <input type="url" class="form-control" id="sheet_url" name="sheet_url" placeholder="https://docs.google.com/spreadsheets/d/..." required style="width: 100%; padding: 5px; margin: 5px 0;">
                        <p class="help" style="font-size: 0.9em; color: #666; margin: 5px 0;">
                            Asegúrate de que el Google Sheet esté compartido públicamente.<br>
                            Ejemplo: https://docs.google.com/spreadsheets/d/1234567890/edit#gid=0
                        </p>
                    </div>
                    <div class="form-group">
                        <h3>Formato requerido del archivo:</h3>
                        <ul style="padding-left: 20px;">
                            <li><strong>name</strong> (nombre del producto) - Obligatorio</li>
                            <li><strong>price</strong> (precio) - Obligatorio</li>
                            <li><strong>product_type</strong> (tipo: escapulario, imagen_religiosa, kit_sanacion, otro) - Obligatorio</li>
                            <li><strong>description</strong> (descripción) - Opcional</li>
                            <li><strong>categories</strong> (categorías, separadas por coma) - Opcional</li>
                            <li><strong>is_available</strong> (disponible: true/false) - Opcional</li>
                        </ul>
                    </div>
                    <div class="submit-row">
                        <button type="button" id="cancel-import" class="btn" style="margin-right: 10px;">Cancelar</button>
                        <input type="submit" value="Importar Productos" class="default" name="_import">
                    </div>
                </form>
            </div>
        </div>

        <div id="modal-overlay" style="display:none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1040;"></div>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const importLink = document.getElementById('import-sheets-link');
                const importDialog = document.getElementById('google-sheet-import');
                const overlay = document.getElementById('modal-overlay');
                const cancelBtn = document.getElementById('cancel-import');

                // Mostrar el formulario cuando se hace clic en el enlace
                importLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    importDialog.style.display = 'block';
                    overlay.style.display = 'block';
                });

                // Ocultar el formulario cuando se hace clic en cancelar
                cancelBtn.addEventListener('click', function() {
                    importDialog.style.display = 'none';
                    overlay.style.display = 'none';
                });

                // Ocultar el formulario cuando se hace clic en el overlay
                overlay.addEventListener('click', function() {
                    importDialog.style.display = 'none';
                    overlay.style.display = 'none';
                });
            });
        </script>
    {% endif %}
{% endblock %}